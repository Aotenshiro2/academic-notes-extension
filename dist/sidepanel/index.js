var pe=Object.defineProperty;var xe=(r,s,l)=>s in r?pe(r,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[s]=l;var q=(r,s,l)=>xe(r,typeof s!="symbol"?s+"":s,l);import{c as N,j as e,B as Y,r as p,a as he,R as fe}from"../chunks/index-DR4h29YS.js";import{L as F,S as ee,P as ge,C as be,f as ye,X as je,a as ve,b as Ne,T as we,c as ke,d as Ce,E as _,D as Se,G as Ae,e as Ee,g as Ie,A as Pe,h as Te}from"../chunks/AnalyzeNoteDialog-Pt3SRBtU.js";import{C as te,A as ze,T as Re}from"../chunks/ThemeToggle-Zg-9hEYw.js";import{s as v,a as De}from"../chunks/storage-D8IV6tbf.js";import"../chunks/_commonjsHelpers-Cpj98o6Y.js";import"../chunks/preload-helper-D7HrI6pR.js";const Le=N("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Me=N("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),G=N("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Oe=N("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Ue=N("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),$e=N("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),qe=N("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Fe=N("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),re=N("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),He=N("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),se=N("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Ge=N("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ke=N("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Je=N("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function Be({onShowHistory:r,onHome:s,onFullscreen:l,onExportPDF:i,onAnalyze:m,isExporting:o=!1}){return e.jsx("div",{className:"header-section px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-lg font-semibold text-foreground",children:["Trading Notes ",e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"by AOK"})]})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:i,disabled:!i||o,className:`p-2 rounded-md transition-colors ${i&&!o?"text-muted-foreground hover:text-foreground hover:bg-muted":"text-muted-foreground/40 cursor-not-allowed"}`,title:o?"Export en cours...":i?"Exporter en PDF":"Sélectionnez une note pour exporter","aria-label":"Exporter en PDF",children:o?e.jsx(F,{size:18,className:"animate-spin"}):e.jsx(se,{size:18})}),e.jsx("button",{onClick:m,disabled:!m,className:`p-2 rounded-md transition-colors ${m?"text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 hover:bg-purple-500/10":"text-muted-foreground/40 cursor-not-allowed"}`,title:m?"Analyser avec une IA":"Sélectionnez une note pour analyser","aria-label":"Analyser avec une IA",children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:l,className:"p-2 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Ouvrir dans Journal d'Études","aria-label":"Ouvrir dans Journal d'Études",children:e.jsx(Fe,{size:18})}),e.jsx("button",{onClick:r,className:"p-2 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Historique des notes","aria-label":"Historique des notes",children:e.jsx(te,{size:18})}),e.jsx("button",{onClick:s,className:"p-2 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Nouvelle capture","aria-label":"Nouvelle capture",children:e.jsx(ge,{size:18})})]})]})})}function Ve({onCapturePage:r,onSmartCapture:s,isCapturing:l=!1,lastNote:i,onSelectNote:m}){var o;return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Y,{size:32,className:"text-primary"})}),e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-2",children:"Prêt à prendre des notes ?"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"Écrivez dans la zone ci-dessous ou capturez cette page."})]}),e.jsxs("div",{className:"space-y-3 w-full max-w-md",children:[s&&e.jsxs("button",{onClick:s,className:"w-full flex items-center space-x-3 p-4 text-left rounded-lg border border-purple-200 dark:border-purple-800/30 hover:bg-purple-50 dark:hover:bg-purple-900/10 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 dark:bg-purple-900/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ee,{size:20,className:"text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:"Capture intelligente"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Résumé + points clés de la page"})]})]}),r&&e.jsxs("button",{onClick:r,disabled:l,className:"w-full flex items-center space-x-3 p-4 text-left rounded-lg border border-border hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("div",{className:"w-10 h-10 bg-green-50 dark:bg-green-900/20 rounded-lg flex items-center justify-center flex-shrink-0",children:l?e.jsx(F,{size:20,className:"text-green-600 dark:text-green-400 animate-spin"}):e.jsx(be,{size:20,className:"text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:l?"Capture en cours...":"Capturer cette page"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Screenshot + titre et URL"})]})]}),i&&m&&e.jsxs("button",{onClick:()=>m(i.id),className:"w-full flex items-center space-x-3 p-4 text-left rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Oe,{size:20,className:"text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-foreground truncate",children:i.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[ye(i.timestamp),((o=i.metadata)==null?void 0:o.domain)&&` • ${i.metadata.domain}`]})]})]})]})]})}function _e({isOpen:r,onClose:s,notes:l,currentNoteId:i,onSelectNote:m,onNotesUpdate:o}){const b=p.useRef(null),[y,g]=p.useState(null),[k,S]=p.useState(""),[C,I]=p.useState(null),[D,L]=p.useState(!1);if(p.useEffect(()=>{const c=u=>{C||b.current&&!b.current.contains(u.target)&&s()};return r&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[r,s,C]),p.useEffect(()=>{r||I(null)},[r]),!r)return null;const A=(c,u=50)=>c.length>u?c.slice(0,u)+"...":c,$=(c,u)=>{u.stopPropagation(),g(c.id),S(c.title)},M=async c=>{if(k.trim())try{const u=l.find(a=>a.id===c);if(u){const a={...u,title:k.trim()};await v.saveNote(a),g(null),S(""),o==null||o()}}catch(u){console.error("Error saving title:",u)}},P=()=>{g(null),S("")},T=(c,u)=>{c.key==="Enter"?(c.preventDefault(),M(u)):c.key==="Escape"&&P()},O=(c,u)=>{u.stopPropagation(),I(c)},z=async()=>{if(C){L(!0);try{await v.deleteNote(C),o==null||o()}catch(c){console.error("Error deleting note:",c)}finally{L(!1),I(null)}}};return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/20",onClick:s}),e.jsxs("div",{ref:b,className:"absolute top-0 right-0 w-80 h-full bg-background border-l border-border shadow-xl animate-slide-in flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{size:20,className:"text-muted-foreground"}),e.jsx("h2",{className:"font-semibold text-foreground",children:"Historique des notes"})]}),e.jsx("button",{onClick:s,className:"p-1 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors","aria-label":"Fermer l'historique",children:e.jsx(je,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(G,{size:48,className:"text-muted-foreground/40 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune note trouvée"}),e.jsx("p",{className:"text-sm text-muted-foreground/80 mt-1",children:"Créez votre première note pour commencer"})]}):e.jsx("div",{className:"space-y-1",children:l.map(c=>e.jsx("button",{onClick:()=>{y!==c.id&&(m(c.id),s())},className:`group w-full p-3 text-left rounded-lg transition-colors ${c.id===i?"bg-primary/10 border border-primary/20":"hover:bg-muted/50 border border-transparent"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(G,{size:14,className:"text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center space-x-2",children:y===c.id?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:k,onChange:u=>S(u.target.value),onKeyDown:u=>T(u,c.id),onBlur:()=>M(c.id),className:"flex-1 text-sm font-medium bg-background border border-border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",autoFocus:!0}),e.jsx("button",{onClick:u=>{u.stopPropagation(),M(c.id)},className:"p-1 text-green-600 hover:text-green-700 rounded transition-colors",title:"Sauvegarder","aria-label":"Sauvegarder le titre",children:e.jsx(ve,{size:12})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),P()},className:"p-1 text-muted-foreground hover:text-foreground rounded transition-colors",title:"Annuler","aria-label":"Annuler la modification",children:e.jsx(Ke,{size:12})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"flex-1 font-medium text-foreground text-sm truncate",children:A(c.title)}),e.jsx("button",{onClick:u=>$(c,u),className:"p-1 text-muted-foreground hover:text-primary rounded transition-colors opacity-0 group-hover:opacity-100",title:"Modifier le titre","aria-label":"Modifier le titre",children:e.jsx(Ne,{size:12})}),e.jsx("button",{onClick:u=>O(c.id,u),className:"p-1 text-muted-foreground hover:text-destructive rounded transition-colors opacity-0 group-hover:opacity-100",title:"Supprimer la note","aria-label":"Supprimer la note",children:e.jsx(we,{size:12})})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[ke(c.timestamp)," • ",c.metadata.domain]}),c.tags.length>0&&e.jsxs("div",{className:"flex space-x-1 mt-2",children:[c.tags.slice(0,2).map((u,a)=>e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-muted text-muted-foreground rounded",children:u},a)),c.tags.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",c.tags.length-2]})]})]})]})},c.id))})}),e.jsx("div",{className:"border-t border-border p-3 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.length," note",l.length>1?"s":""," au total"]})})]}),e.jsx(Ce,{isOpen:!!C,onConfirm:z,onCancel:()=>I(null),title:"Supprimer la note",message:"Cette action est irréversible.",isLoading:D})]})}function Ze(){const[r,s]=p.useState(!0);if(!r)return null;const l=()=>{chrome.tabs.create({url:"https://www.skool.com/aoknowledge-trading/about"})};return e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 border-b border-orange-200/50 px-3 py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-orange-800 font-medium",children:"Entourez-vous des meilleurs"}),e.jsx("button",{onClick:l,className:"px-2 py-0.5 bg-orange-600 text-white text-xs font-medium rounded hover:bg-orange-700 transition-colors",children:"Rejoins-nous"})]})})}class We{constructor(){q(this,"session",null)}async isAvailable(){try{if(typeof window<"u"&&"ai"in window){const s=window.ai;if(s&&s.canCreateTextSession)return await s.canCreateTextSession()==="readily"}return!1}catch{return!1}}async process(s,l){if(!this.session){const o=window.ai;this.session=await o.createTextSession()}const i=`${l}

Contenu:
${s}`;return(await this.session.prompt(i)).trim()}destroy(){this.session&&(this.session.destroy(),this.session=null)}}class Z{constructor(s){q(this,"config");this.config=s}async process(s,l){const{provider:i,apiKey:m,model:o}=this.config;switch(i){case"openai":return this.callOpenAI(s,l,m,o);case"anthropic":return this.callAnthropic(s,l,m,o);case"gemini":return this.callGemini(s,l,m,o);default:throw new Error(`Fournisseur IA non supporté: ${i}`)}}async callOpenAI(s,l,i,m){var y;const o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:m||"gpt-4o-mini",messages:[{role:"system",content:l},{role:"user",content:s}],temperature:.3,max_tokens:2e3})});if(!o.ok){const g=await o.json().catch(()=>({}));throw new Error(`OpenAI API error: ${((y=g.error)==null?void 0:y.message)||o.statusText}`)}return(await o.json()).choices[0].message.content.trim()}async callAnthropic(s,l,i,m){var y;const o=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:m||"claude-3-haiku-20240307",system:l,messages:[{role:"user",content:s}],max_tokens:2e3,temperature:.3})});if(!o.ok){const g=await o.json().catch(()=>({}));throw new Error(`Anthropic API error: ${((y=g.error)==null?void 0:y.message)||o.statusText}`)}return(await o.json()).content[0].text.trim()}async callGemini(s,l,i,m){var g;const b=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${m||"gemini-2.0-flash"}:generateContent?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`${l}

${s}`}]}],generationConfig:{temperature:.3,maxOutputTokens:2e3}})});if(!b.ok){const k=await b.json().catch(()=>({}));throw new Error(`Gemini API error: ${((g=k.error)==null?void 0:g.message)||b.statusText}`)}return(await b.json()).candidates[0].content.parts[0].text.trim()}}const W=`Tu es un assistant d'analyse de contenu web. Analyse le contenu fourni et retourne un JSON avec exactement cette structure :

{
  "summary": "Un résumé concis en 2-3 phrases du contenu principal",
  "keyPoints": ["Point clé 1", "Point clé 2", "Point clé 3", "Point clé 4", "Point clé 5"],
  "concepts": ["Concept 1", "Concept 2", "Concept 3", "Concept 4"],
  "tags": ["tag1", "tag2", "tag3"]
}

Règles :
- Le résumé doit capturer l'essentiel en français
- 3 à 7 points clés, chacun en une phrase courte
- 3 à 6 concepts/termes importants
- 3 à 5 tags de classification courts
- Réponds UNIQUEMENT avec le JSON, sans texte avant ou après
- Si le contenu est une transcription vidéo, identifie les enseignements principaux`;class Xe{constructor(s){q(this,"chromeAI");q(this,"config");this.chromeAI=new We,this.config=s||null}async smartCapture(s){var m;const l=s.substring(0,6e3);let i;try{if(await this.chromeAI.isAvailable())return i=await this.chromeAI.process(l,W),this.parseResponse(i)}catch(o){console.warn("Chrome AI failed, trying external API:",o)}if((m=this.config)!=null&&m.apiKey)try{return i=await new Z(this.config).process(l,W),this.parseResponse(i)}catch(o){throw console.error("External API failed:",o),new Error(`Erreur API ${this.config.provider}: ${o instanceof Error?o.message:"Erreur inconnue"}`)}throw new Error("Aucun service IA disponible. Configurez une clé API dans les paramètres.")}parseResponse(s){const l=s.replace(/```json\s*|```\s*/g,"").trim();try{const i=JSON.parse(l);return{summary:typeof i.summary=="string"?i.summary:"",keyPoints:Array.isArray(i.keyPoints)?i.keyPoints.filter(m=>typeof m=="string"):[],concepts:Array.isArray(i.concepts)?i.concepts.filter(m=>typeof m=="string"):[],tags:Array.isArray(i.tags)?i.tags.filter(m=>typeof m=="string").map(m=>m.toLowerCase()):[]}}catch{return{summary:s.substring(0,500),keyPoints:[],concepts:[],tags:[]}}}async testConnection(){var s;if(!((s=this.config)!=null&&s.apiKey))return{success:!1,error:"Aucune clé API configurée"};try{return await new Z(this.config).process("Test de connexion.",'Réponds simplement "OK".'),{success:!0}}catch(l){return{success:!1,error:l instanceof Error?l.message:"Erreur de connexion"}}}destroy(){this.chromeAI.destroy()}}const X={openai:[{label:"GPT-4o Mini (Recommandé)",value:"gpt-4o-mini"},{label:"GPT-4o",value:"gpt-4o"},{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"}],anthropic:[{label:"Claude 3 Haiku (Recommandé)",value:"claude-3-haiku-20240307"},{label:"Claude 3.5 Sonnet",value:"claude-3-5-sonnet-20241022"}],gemini:[{label:"Gemini 2.0 Flash (Recommandé)",value:"gemini-2.0-flash"},{label:"Gemini 1.5 Flash",value:"gemini-1.5-flash"},{label:"Gemini 1.5 Pro",value:"gemini-1.5-pro"}]},Q={openai:"OpenAI",anthropic:"Anthropic (Claude)",gemini:"Google Gemini"};function Qe({settings:r,onChange:s,onExport:l,onImport:i,onSyncToJournal:m}){var T,O,z,c,u;const[o,b]=p.useState(null),[y,g]=p.useState(!1),[k,S]=p.useState(null),C=(a,h)=>{s({[a]:h})},I=(a,h)=>{s({journalSync:{...r.journalSync,[a]:h}})},D=()=>{o==null||o.click()},L=async()=>{try{(await fetch(r.journalSync.journalAppUrl+"/api/health")).ok?alert("Connexion réussie avec Journal d'Études"):alert("Impossible de se connecter à Journal d'Études")}catch(a){alert("Erreur de connexion : "+a)}},A=a=>{var j;const h=X[a];s({aiConfig:{provider:a,apiKey:((j=r.aiConfig)==null?void 0:j.apiKey)||"",model:h[0].value}})},$=a=>{var h,j;s({aiConfig:{provider:((h=r.aiConfig)==null?void 0:h.provider)||"openai",apiKey:a,model:((j=r.aiConfig)==null?void 0:j.model)||"gpt-4o-mini"}})},M=a=>{var h,j;s({aiConfig:{provider:((h=r.aiConfig)==null?void 0:h.provider)||"openai",apiKey:((j=r.aiConfig)==null?void 0:j.apiKey)||"",model:a}})},P=async()=>{var a;if(!((a=r.aiConfig)!=null&&a.apiKey)){S({success:!1,message:"Veuillez entrer une clé API"});return}g(!0),S(null);try{const h=new Xe(r.aiConfig),j=await h.testConnection();h.destroy(),S({success:j.success,message:j.success?"Connexion réussie !":j.error||"Erreur de connexion"})}catch(h){S({success:!1,message:h instanceof Error?h.message:"Erreur inconnue"})}finally{g(!1)}};return e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-foreground mb-6 flex items-center",children:[e.jsx(re,{size:20,className:"mr-2"}),"Configuration"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Je,{size:16,className:"mr-2"}),"Capture automatique"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Capture automatique"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Capturer automatiquement les pages visitées"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.autoCapture,onChange:a=>C("autoCapture",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Captures d'écran"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inclure des captures d'écran dans les notes"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.captureScreenshots,onChange:a=>C("captureScreenshots",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Extraction intelligente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Extraire uniquement le contenu principal"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.extractMainContent,onChange:a=>C("extractMainContent",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Me,{size:16,className:"mr-2"}),"Intelligence artificielle"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Résumés automatiques"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Générer des résumés avec l'IA locale (Chrome AI)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.aiSummaryEnabled,onChange:a=>C("aiSummaryEnabled",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ue,{size:16,className:"text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Fonctionnalités IA disponibles :"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Résumés automatiques du contenu"}),e.jsx("li",{children:"Extraction de concepts clés"}),e.jsx("li",{children:"Points clés de la page"}),e.jsx("li",{children:"Transcription YouTube"})]})]})]})}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($e,{size:16,className:"text-muted-foreground"}),e.jsx("p",{className:"font-medium text-foreground",children:"Configuration API"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Chrome AI sera utilisé automatiquement si disponible. Sinon, l'API externe configurée ci-dessous sera utilisée."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-1",children:"Fournisseur"}),e.jsx("select",{value:((T=r.aiConfig)==null?void 0:T.provider)||"openai",onChange:a=>A(a.target.value),className:"input-field",children:Object.keys(Q).map(a=>e.jsx("option",{value:a,children:Q[a]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-1",children:"Clé API"}),e.jsx("input",{type:"password",value:((O=r.aiConfig)==null?void 0:O.apiKey)||"",onChange:a=>$(a.target.value),className:"input-field",placeholder:"sk-... ou clé API"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-1",children:"Modèle"}),e.jsx("select",{value:((z=r.aiConfig)==null?void 0:z.model)||"gpt-4o-mini",onChange:a=>M(a.target.value),className:"input-field",children:X[((c=r.aiConfig)==null?void 0:c.provider)||"openai"].map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:P,disabled:y||!((u=r.aiConfig)!=null&&u.apiKey),className:"btn-secondary text-sm flex items-center gap-1 disabled:opacity-50",children:[y?e.jsx(F,{size:14,className:"animate-spin"}):e.jsx(_,{size:14}),e.jsx("span",{children:"Tester"})]}),k&&e.jsx("span",{className:`text-sm ${k.success?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:k.message})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Le,{size:16,className:"mr-2"}),"Journal d'Études"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Synchronisation automatique"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Envoyer les notes vers Journal d'Études"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.journalSync.syncEnabled,onChange:a=>I("syncEnabled",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-1",children:"URL de l'application"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"url",value:r.journalSync.journalAppUrl,onChange:a=>I("journalAppUrl",a.target.value),className:"input-field flex-1",placeholder:"https://trading-journal.app"}),e.jsxs("button",{onClick:L,className:"btn-secondary flex items-center space-x-1",children:[e.jsx(_,{size:14}),e.jsx("span",{children:"Test"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Notes en attente : ",r.journalSync.pendingNotes.length]}),e.jsx("button",{onClick:m,className:"btn-primary text-sm",disabled:!r.journalSync.syncEnabled||r.journalSync.pendingNotes.length===0,children:"Synchroniser maintenant"})]}),r.journalSync.lastSync>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Dernière sync : ",new Date(r.journalSync.lastSync).toLocaleString("fr-FR")]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-medium text-foreground mb-3 flex items-center",children:[e.jsx(G,{size:16,className:"mr-2"}),"Sauvegarde des données"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:l,className:"flex items-center justify-center space-x-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(se,{size:16,className:"text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Exporter"})]}),e.jsxs("button",{onClick:D,className:"flex items-center justify-center space-x-2 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors",children:[e.jsx(Se,{size:16,className:"text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-green-700 dark:text-green-300 font-medium",children:"Importer"})]})]}),e.jsx("input",{ref:b,type:"file",accept:".json",onChange:i,className:"hidden"}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:[e.jsx("strong",{children:"Note :"})," L'export inclut toutes vos notes, captures et paramètres. L'import remplacera les données existantes."]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Ae,{size:16,className:"mr-2"}),"Préférences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-1",children:"Langue de l'interface"}),e.jsxs("select",{value:r.language,onChange:a=>s({language:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"fr",children:"Français"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/80 mb-2",children:"Tags par défaut"}),e.jsx("input",{type:"text",value:r.defaultTags.join(", "),onChange:a=>s({defaultTags:a.target.value.split(",").map(h=>h.trim()).filter(Boolean)}),className:"input-field",placeholder:"Séparer les tags par des virgules"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ces tags seront automatiquement ajoutés à chaque nouvelle note"})]})]})]})]})}function Ye(){const[r,s]=p.useState(null),[l,i]=p.useState(!1),[m,o]=p.useState(!1),[b,y]=p.useState([]),[g,k]=p.useState(null),[S,C]=p.useState(!0),[I,D]=p.useState(""),L=p.useRef(null),A=p.useRef(null),[$,M]=p.useState(null),[P,T]=p.useState(!1),[O,z]=p.useState(null),[c,u]=p.useState(0),[a,h]=p.useState(!1),[j,K]=p.useState(!1),[ae,J]=p.useState(!1);p.useEffect(()=>{E(),H(),chrome.storage.session.set({sidePanelOpen:!0});const t=f=>{f.type==="CLOSE_SIDEPANEL"&&chrome.storage.session.set({sidePanelOpen:!1}).then(()=>{window.close()})};chrome.runtime.onMessage.addListener(t);const n=()=>{H()},x=(f,R)=>{(R.url||R.title)&&H()};chrome.tabs.onActivated.addListener(n),chrome.tabs.onUpdated.addListener(x);const d=De.subscribe(f=>{f.source!=="sidepanel"&&(E(),f.noteId&&u(Date.now()))}),w=()=>{chrome.storage.session.set({sidePanelOpen:!1})};return window.addEventListener("beforeunload",w),()=>{chrome.runtime.onMessage.removeListener(t),chrome.tabs.onActivated.removeListener(n),chrome.tabs.onUpdated.removeListener(x),window.removeEventListener("beforeunload",w),d(),chrome.storage.session.set({sidePanelOpen:!1})}},[]);async function H(){try{const n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];n&&M({url:n.url||"",title:n.title||"Page sans titre"})}catch(t){console.error("Error loading current page info:",t)}}async function E(){try{const[t,n]=await Promise.all([v.getNotes(1e3),v.getSettings()]);y(t),k(n)}catch(t){console.error("Error loading data:",t)}finally{C(!1)}}const ne=async(t,n)=>{try{const d=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];let w="";try{d!=null&&d.url&&(w=new URL(d.url).hostname)}catch{console.warn("Invalid URL:",d==null?void 0:d.url)}if(n)await v.addMessageToNote(n,{type:"text",content:t}),await E(),u(Date.now());else{const f=Date.now().toString(),R={id:f,title:t.slice(0,50)+(t.length>50?"...":""),content:t,url:(d==null?void 0:d.url)||"",favicon:(d==null?void 0:d.favIconUrl)||"",timestamp:Date.now(),type:"manual",tags:[],concepts:[],screenshots:[],metadata:{domain:w,title:(d==null?void 0:d.title)||"Note de trading",language:"fr"}};await v.saveNote(R),s(f),await E(),u(Date.now())}D(""),setTimeout(()=>{var f;(f=L.current)==null||f.focus(),A.current&&(A.current.scrollTop=A.current.scrollHeight)},100)}catch(x){console.error("Error adding content:",x),alert("Erreur lors de l'ajout du contenu")}},oe=()=>{s(null)},le=async()=>{K(!0);try{const n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(!n){alert("Impossible de récupérer les informations de la page");return}let x="";try{n.url&&(x=new URL(n.url).hostname.replace("www.",""))}catch{console.warn("Invalid URL:",n.url)}let d="";try{d=await chrome.tabs.captureVisibleTab()}catch(V){console.warn("Screenshot capture failed:",V)}const w=Date.now().toString(),f=n.title||"Page sans titre";let R=`<p><strong>${f}</strong></p><p><a href="${n.url}" target="_blank">${n.url}</a></p>`;d&&(R+=`<p><img src="${d}" alt="Capture de ${x}" style="max-width:100%; border-radius:8px; margin-top:8px;"/></p>`),R+="<p></p>";const me={id:w,title:f.slice(0,50)+(f.length>50?"...":""),content:R,url:n.url||"",favicon:n.favIconUrl||"",timestamp:Date.now(),type:"webpage",tags:[],concepts:[],screenshots:[],metadata:{domain:x,title:f,language:"fr"}};await v.saveNote(me),s(w),await E()}catch(t){console.error("Error capturing page:",t),alert("Erreur lors de la capture de la page")}finally{K(!1)}},ie=async()=>{try{const t=await chrome.runtime.sendMessage({type:"CAPTURE_SCREENSHOT"});return(t==null?void 0:t.dataUrl)||null}catch(t){return console.error("Error taking screenshot:",t),null}},B=async()=>{T(!0),z(null);try{const t=await chrome.runtime.sendMessage({type:"SMART_CAPTURE"});if(!(t!=null&&t.success))throw new Error((t==null?void 0:t.error)||"Extraction échouée");let n="";try{n=await chrome.tabs.captureVisibleTab()}catch(f){console.warn("Screenshot capture failed:",f)}const x=Date.now().toString();let d="";n&&(d+=`<p><img src="${n}" alt="Capture de la page" style="max-width:100%; border-radius:8px; margin-top:8px;"/></p>`),d+="<p></p><p><em>Mes notes:</em></p><p></p>";const w={id:x,title:t.pageTitle.slice(0,80)+(t.pageTitle.length>80?"...":""),content:d,summary:t.summary||"",keyPoints:t.keyPoints||[],url:t.url,favicon:t.favicon,timestamp:Date.now(),type:t.contentType||"webpage",tags:t.tags||[],concepts:t.concepts||[],screenshots:[],metadata:{domain:t.domain,title:t.pageTitle,author:t.author,description:t.description,ogImage:t.ogImage,siteName:t.siteName,language:"fr"}};await v.saveNote(w),s(x),D(""),await E()}catch(t){console.error("Smart capture error:",t),z(t instanceof Error?t.message:"Erreur lors de la capture intelligente")}finally{T(!1)}},ce=async()=>{var t;if(r){T(!0),z(null);try{const n=await chrome.runtime.sendMessage({type:"SMART_CAPTURE"});if(!(n!=null&&n.success))throw new Error((n==null?void 0:n.error)||"Extraction échouée");let x=`<hr><p><strong>--- Capture: ${n.pageTitle} ---</strong></p>`;n.summary&&(x+=`<p><strong>Résumé:</strong> ${n.summary}</p>`),((t=n.keyPoints)==null?void 0:t.length)>0&&(x+="<p><strong>Points clés:</strong></p><ul>",n.keyPoints.forEach(d=>x+=`<li>${d}</li>`),x+="</ul>"),await v.addMessageToNote(r,{type:"text",content:x});try{const d=await chrome.tabs.captureVisibleTab();d&&await v.addMessageToNote(r,{type:"image",content:d,metadata:{alt:"Capture de la page"}})}catch(d){console.warn("Screenshot capture failed:",d)}await E(),u(Date.now()),setTimeout(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},100)}catch(n){console.error("Smart capture to current note error:",n),z(n instanceof Error?n.message:"Erreur lors de la capture")}finally{T(!1)}}},de=async()=>{if(U){h(!0);try{await Te(U)}catch(t){console.error("Error exporting PDF:",t),alert("Erreur lors de l'export PDF")}finally{h(!1)}}},ue=async()=>{try{const t=chrome.runtime.getURL("src/fullscreen/index.html"),n=r?`${t}?noteId=${r}`:t;await chrome.tabs.create({url:n}),chrome.storage.session.set({sidePanelOpen:!1}),window.close()}catch(t){console.error("Error opening fullscreen view:",t),alert("Erreur lors de l'ouverture de la vue étendue")}};if(S)return e.jsx("div",{className:"sidebar-container",children:e.jsx("div",{className:"flex items-center justify-center h-full animate-fade-in-up",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de vos notes..."})]})})});const U=r?b.find(t=>t.id===r):null;return e.jsxs("div",{className:"sidebar-container",children:[e.jsx(Ze,{}),e.jsx(Be,{onShowHistory:()=>i(!l),onHome:oe,onFullscreen:ue,onExportPDF:U?de:void 0,onAnalyze:U?()=>J(!0):void 0,isExporting:a}),e.jsxs("main",{className:"content-section flex flex-col",children:[e.jsx("div",{ref:A,className:"flex-1 overflow-y-auto p-4",children:m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-border",children:[e.jsx("button",{onClick:()=>o(!1),className:"p-2 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Retour","aria-label":"Retour",children:e.jsx(ze,{size:18})}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Paramètres"})]}),e.jsx(Qe,{settings:g,onChange:async t=>{await v.saveSettings(t);const n=await v.getSettings();k(n)},onExport:async()=>{const t=await v.exportData(),n=new Blob([t],{type:"application/json"}),x=URL.createObjectURL(n),d=document.createElement("a");d.href=x,d.download=`trading-notes-backup-${new Date().toISOString().split("T")[0]}.json`,d.click(),URL.revokeObjectURL(x)},onImport:async t=>{var x;const n=(x=t.target.files)==null?void 0:x[0];if(n){const d=await n.text(),w=await v.importData(d);w.success?(alert("Import réussi !"),await E()):alert("Erreur import : "+w.error)}},onSyncToJournal:()=>{alert("Sync Journal non implémenté")}})]}):r?e.jsx(Ee,{noteId:r,onNoteUpdate:E,refreshTrigger:c}):e.jsxs(e.Fragment,{children:[P&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin text-purple-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analyse de la page en cours..."})]})}),O&&!P&&e.jsx("div",{className:"mx-4 mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:O})}),!P&&e.jsx(Ve,{onCapturePage:le,onSmartCapture:B,isCapturing:j,lastNote:b.length>0?b.reduce((t,n)=>n.timestamp>t.timestamp?n:t):void 0,onSelectNote:s})]})}),e.jsx("div",{className:"bg-background px-4 pt-3 pb-1",children:e.jsx(Ie,{ref:L,value:I,onChange:D,placeholder:r?"Ajouter du contenu...":"Écrivez ou capturez...",onInsertScreenshot:ie,onSubmit:t=>ne(t,r),onSmartCapture:r?ce:B,isSmartCapturing:P,currentPageInfo:$||void 0,className:"w-full"})}),e.jsxs("div",{className:"px-4 pb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-[10px] text-muted-foreground/60 select-none",children:["v",chrome.runtime.getManifest().version]}),e.jsx("span",{className:"text-muted-foreground/30",children:"|"}),e.jsxs("span",{className:"flex items-center gap-1 px-1 py-0.5 text-[10px] text-muted-foreground/60 select-none",title:"Langue : Français",children:[e.jsxs("svg",{width:"14",height:"10",viewBox:"0 0 3 2",className:"rounded-[1px] flex-shrink-0",children:[e.jsx("rect",{width:"1",height:"2",x:"0",fill:"#002395"}),e.jsx("rect",{width:"1",height:"2",x:"1",fill:"#fff"}),e.jsx("rect",{width:"1",height:"2",x:"2",fill:"#ED2939"})]}),"FR"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Re,{compact:!0}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL("src/guide/index.html")}),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Guide","aria-label":"Guide",children:e.jsx(Y,{size:14})}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:"mailto:brice.d@aoknowledge.com"}),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Nous contacter","aria-label":"Nous contacter",children:e.jsx(qe,{size:14})}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:"https://chromewebstore.google.com/detail/trading-notes-by-aoknowle/phajegonlmgnjkkfdooedoddnmgpheic/reviews"}),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Évaluez-nous","aria-label":"Évaluez-nous",children:e.jsx(He,{size:14})}),e.jsx("button",{disabled:!0,className:"p-1.5 text-muted-foreground/40 cursor-not-allowed rounded-md",title:"Compte (bientôt)","aria-label":"Compte (bientôt)",children:e.jsx(Ge,{size:14})}),e.jsx("button",{onClick:()=>o(!m),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",title:"Paramètres","aria-label":"Paramètres",children:e.jsx(re,{size:14})})]})]})]}),e.jsx(_e,{isOpen:l,onClose:()=>i(!1),notes:b,currentNoteId:r,onSelectNote:s,onNotesUpdate:E}),U&&e.jsx(Pe,{isOpen:ae,onClose:()=>J(!1),note:U,defaultProvider:g==null?void 0:g.analysisProvider})]})}he.createRoot(document.getElementById("root")).render(e.jsx(fe.StrictMode,{children:e.jsx(Ye,{})}));
